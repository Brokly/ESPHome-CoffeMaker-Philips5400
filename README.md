# ESPHome-CoffeMaker-Philips5400
Компонент для управления кофеваркой Philips 5400  из Home Assistants на базе ESPHome

Написан на основе исследований, в качестве помощи для Divan (https://github.com/DivanX10).
Модуль на базе  ESP32 перехватывает протокол обмена основной платы и дисплея кофмашины. Позволяет полноценное удаленное управление кофеваркой. Это стало возсожным благодаря частичной расшифровке протокола.

Настройки доступные в YAML

philips_series_5400:
  
  display_uart: - uart подключенный к плате дисплея кофемашины
  mainboard_uart: - uart подключенный к основной плате кофемашины
  restore_value: - логический параметр (true/false), восстанавливать ли настройки кофе при перезагрузке
  debug: - логический параметр (true/false), режим отладки, позволяет изучить синтез пакета рецепта кофе
  B0_msg: - текстовый сенсор, показывает содержимое верехваченного пакета с заголовком 0xBO
  B5_msg: - текстовый сенсор, показывает содержимое верехваченного пакета с заголовком 0xB5
  BA_msg: - текстовый сенсор, показывает содержимое верехваченного пакета с заголовком 0xBA
  90_msg: - текстовый сенсор, показывает содержимое верехваченного пакета с заголовком 0x90 (пакет рецепта)
  91_msg: - текстовый сенсор, показывает содержимое верехваченного пакета с заголовком 0x90
  93_msg: - текстовый сенсор, показывает содержимое верехваченного пакета с заголовком 0x90
  Coffee_volume: - number, объем кофе, (поддерживает все стандартные параметры mode, min_value, max_value, step и т.д.) 
  Milk_volume: - number, объем молока, (поддерживает все стандартные параметры mode, min_value, max_value, step и т.д.)
  Strength_select: - select, помол кофе, (поддерживает стандартные свойства, option - позволяет перегрузить английские названия вашими, всего 4 строки)
  Cups_select: - select, количество чашек или ExtraShot, (поддерживает стандартные свойства, option - позволяет перегрузить английские названия вашими, всего 3 строки)
  Product_select: - select, выбор рецепта кофе, (поддерживает стандартные свойства, option - позволяет перегрузить английские названия вашими, всего 14 строк, ПРИМЕР:
    options:
      - "Эспрессо"
      - "Кофе в дорогу"
      - "Кофе"
      - "Эспрессо лунго"
      - "Кафе крема"
      - "Ристретто"
      - "Американо"
      - "Кофе с молоком"
      - "Кофе латте"
      - "Кофе с молоком в дорогу"
      - "Латте макиато"
      - "Капучино"
      - "Молочная пена"
      - "Горячая вода"     
  )
  Display_product: текстовый сенсор, напиток который в данный момент готовит или будет готовить кофевака, текстовая хьюман расшифровка. 
  Start_key: - кнопка запуска приготовления напитка в соответствии с установленным рецептом
  state_sensor: # сенсор, в который компонент публикует статус в цифровом виде
   1 - Не расшифрован (07 01 00)
   2 - Выключена
   3 - Подача молока
   4 - Подача кофе
   5 - Дозирование
   6 - Создание пара для молока
   7 - Заварочный узел в положение заваривания
   8 - Напиток готов
   9 - Нагрев воды
   10 - Перемалывание зерна
   11 - Промывка
   12 - Закончилось зерно
   13 - Не расшифрован (07 08 14)
   14 - Нагрев
   15 - Готово
   17 - Вода в норме
   18 - Контейнер вставлен
   20 - Опорожните контейнер для гущи
   21 - Готова к работе                   
   22 - Долейте воду
   23 - Контейнер извлечен
   24 - Удаление накипи стадия 1
   25 - Удаление накипи стадия 2
   30...37 - Коды ошибок (не расшифрованы)

    Пример использования:
    on_value:
      then:
      - lambda: |-
         if(x==2){
            id(idPowerStatus).publish_state(false);
         } else if(id(idPowerStatus).state==false){
            id(idPowerStatus).publish_state(true);
         }
         if(x==3){id(idStatus).publish_state("Наслаждайтесь");} 
         else if(x==4){id(idStatus).publish_state("Наливаю кофе");}
         else if(x==5){id(idStatus).publish_state("Нагрев воды");}
         // И ТАК ДАЛЕЕ

Больше информации : https://github.com/DivanX10/ESP-Philips-5400-Coffee-Machine
